#!/usr/bin/env ruby

$:.push File.expand_path('../../lib', __FILE__)

require 'rubygems'
require 'optparse'
require 'rest-assured/config'

user_opts = {}

OptionParser.new do |opts|
  opts.banner = "Usage: rest-assured [options]"

  opts.on('-a', '--adapter mysql|sqlite') do |adapter|
    user_opts[:adapter] = adapter
  end

  opts.on('-d', '--database FILENAME', "Either path to database file (sqlite, defaults to ./rest-assured.db) or db name (defaults to rest_assured)") do |fname|
    user_opts[:database] = fname
  end

  opts.on('-u', '--user DBUSER', "Db username") do |user|
    user_opts[:user] = user
  end

  opts.on('-p', '--password DBPASSWORD', 'Db password') do |password|
    user_opts[:password] = password
  end

  opts.on('-h', '--host DBHOST', 'Db host') do |host|
    user_opts[:host] = host
  end

  opts.on('-P', '--port PORT', Integer, "Server port. Defaults to 4578") do |port|
    user_opts[:port] = port
  end

  opts.on('-l', '--logfile FILENAME', "Path to logfile. Defaults to ./rest-assured.log") do |logfile|
    user_opts[:logfile] = logfile
  end

  opts.on_tail("--help", "Show this message") do
    puts opts
    exit
  end
end.parse!

RestAssured::Config.build(user_opts)

require 'rest-assured'
RestAssured::Application.run!
